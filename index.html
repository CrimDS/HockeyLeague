<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fox & Hounds Hockey League</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Dark background */
        }
        /* Marquee-style scrolling animation for scoreboards */
        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        .scrolling-wrapper {
            display: flex;
            animation: scroll 60s linear infinite;
        }
        .scoreboard-container:hover .scrolling-wrapper,
        .news-ticker-container:hover .scrolling-wrapper {
            animation-play-state: paused;
        }
        .scoreboard-card, .news-card {
            flex-shrink: 0;
        }
        /* Custom scrollbar for player stats */
        .player-stats-table::-webkit-scrollbar {
            width: 8px;
        }
        .player-stats-table::-webkit-scrollbar-track {
            background: #2d3748;
        }
        .player-stats-table::-webkit-scrollbar-thumb {
            background-color: #4a5568;
            border-radius: 4px;
        }
    </style>
</head>
<body class="text-gray-200">

    <!-- Header Section -->
    <header class="bg-gray-900 shadow-lg">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex items-center justify-between">
            <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-yellow-400 mr-3" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zM5.05 5.05a.75.75 0 011.06 0l1.06 1.06a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zM14.95 5.05a.75.75 0 011.06 1.06l-1.06 1.06a.75.75 0 01-1.06-1.06l1.06-1.06a.75.75 0 010-1.06zM10 18a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5A.75.75 0 0110 18zM5.05 14.95a.75.75 0 011.06 0l1.06-1.06a.75.75 0 011.06 1.06l-1.06 1.06a.75.75 0 01-1.06 0zM16 10a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5a.75.75 0 01.75.75zM5 10a.75.75 0 01-.75.75H2.75a.75.75 0 010-1.5H4.25A.75.75 0 015 10zM10 5a5 5 0 100 10 5 5 0 000-10z" clip-rule="evenodd" />
                    <path d="M12.25 7.75a.75.75 0 00-1.5 0v2.541l-1.29-1.29a.75.75 0 00-1.06 1.06l2.5 2.5a.75.75 0 001.06 0l2.5-2.5a.75.75 0 00-1.06-1.06L12.25 10.29V7.75z" />
                </svg>
                <h1 class="text-2xl font-bold text-white tracking-tight">Fox & Hounds Hockey League</h1>
            </div>
            <!-- Navigation can go here later -->
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">

        <!-- Scoreboard Ticker -->
        <div id="scoreboard-outline" class="border border-gray-700 rounded-lg p-2 mb-6">
            <div id="scoreboard-container" class="relative overflow-hidden bg-gray-800 rounded-md shadow-inner p-2 h-24 flex items-center">
                <!-- Live Scores will be injected here -->
                <div class="absolute top-0 left-0 h-full w-max flex scrolling-wrapper">
                    <!-- Cloned content for seamless loop -->
                </div>
            </div>
        </div>

        <!-- News Ticker -->
        <div id="news-ticker-container" class="relative overflow-hidden bg-gray-800 rounded-md shadow-inner p-2 h-12 flex items-center">
            <!-- News items will be injected here -->
             <div class="absolute top-0 left-0 h-full w-max flex scrolling-wrapper">
                <!-- Cloned content for seamless loop -->
            </div>
        </div>


        <!-- Rest of the page content -->
        <div class="px-4 py-6 sm:px-0">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Standings Card -->
                <div class="bg-gray-800 rounded-lg shadow p-6">
                    <h2 class="text-xl font-semibold mb-4 text-white">League Standings</h2>
                    <!-- Standings content will go here -->
                </div>

                <!-- Matchups Card -->
                <div class="bg-gray-800 rounded-lg shadow p-6 md:col-span-2">
                    <h2 class="text-xl font-semibold mb-4 text-white">Weekly Matchups</h2>
                    <!-- Matchups content will go here -->
                </div>

            </div>
        </div>
    </main>

    <!-- Game Stats Modal -->
    <div id="stats-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div id="stats-modal-content" class="bg-gray-800 rounded-lg shadow-2xl p-6 border border-gray-600 w-full max-w-2xl">
            <p id="modal-loading-message" class="text-center text-lg">Loading Game Stats...</p>
            <div id="modal-stats-container" class="hidden">
                 <!-- Team stats will be injected here -->
            </div>
        </div>
    </div>


    <script>
        const scoreboardContainer = document.querySelector('#scoreboard-container .scrolling-wrapper');
        const newsTickerContainer = document.querySelector('#news-ticker-container .scrolling-wrapper');
        const statsModal = document.getElementById('stats-modal');
        const statsModalContent = document.getElementById('stats-modal-content');

        // --- SCOREBOARD LOGIC ---

        const fetchScores = async () => {
            try {
                const response = await fetch('/api/nhl-scores');
                if (!response.ok) throw new Error('Network response was not ok');
                const scores = await response.json();
                renderScores(scores.events);
            } catch (error) {
                console.error("Failed to fetch scores:", error);
                scoreboardContainer.innerHTML = `<p class="text-red-400 p-4">Could not load live scores.</p>`;
            }
        };

        const renderScores = (events) => {
            if (!events || events.length === 0) {
                scoreboardContainer.innerHTML = `<p class="p-4">No NHL games scheduled for today.</p>`;
                return;
            }

            const gamesHtml = events.map(game => {
                const competition = game.competitions[0];
                const homeTeam = competition.competitors.find(c => c.homeAway === 'home');
                const awayTeam = competition.competitors.find(c => c.homeAway === 'away');
                const status = game.status.type.detail;

                return `
                    <div class="scoreboard-card bg-gray-900 rounded-lg shadow-md p-3 mx-2 w-64 text-sm border border-gray-700 flex flex-col justify-between" data-game-id="${game.id}">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold text-gray-400">${status}</span>
                        </div>
                        <div class="space-y-1">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <img src="${awayTeam.team.logo}" alt="${awayTeam.team.displayName}" class="w-6 h-6 mr-2">
                                    <span class="font-medium">${awayTeam.team.displayName}</span>
                                </div>
                                <span class="font-bold text-lg">${awayTeam.score || 0}</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <img src="${homeTeam.team.logo}" alt="${homeTeam.team.displayName}" class="w-6 h-6 mr-2">
                                    <span class="font-medium">${homeTeam.team.displayName}</span>
                                </div>
                                <span class="font-bold text-lg">${homeTeam.score || 0}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            scoreboardContainer.innerHTML = gamesHtml;
            // Clone content for seamless scrolling effect if there's enough content
            if (events.length > 3) {
                scoreboardContainer.innerHTML += gamesHtml;
            }
        };


        // --- NEWS TICKER LOGIC ---

        const fetchNews = async () => {
            try {
                const response = await fetch('/api/nhl-news');
                if (!response.ok) throw new Error('Failed to fetch news');
                const news = await response.json();
                renderNews(news);
            } catch (error) {
                console.error("Failed to fetch news:", error);
                newsTickerContainer.innerHTML = `<p class="text-red-400 px-4">Could not load news.</p>`;
            }
        };

        const renderNews = (newsItems) => {
            if (!newsItems || newsItems.length === 0) {
                newsTickerContainer.innerHTML = `<p class="px-4 text-gray-400">No recent news found for today.</p>`;
                return;
            }
            const newsHtml = newsItems.map(item => `
                <div class="news-card flex items-center mx-4">
                    <span class="font-semibold text-sky-400 mr-2">NHL News:</span>
                    <a href="${item.link}" target="_blank" rel="noopener noreferrer" class="hover:underline text-gray-200">
                        ${item.title}
                    </a>
                </div>
            `).join('');

            newsTickerContainer.innerHTML = newsHtml;
             if (newsItems.length > 2) {
                newsTickerContainer.innerHTML += newsHtml;
            }
        };


        // --- GAME STATS MODAL LOGIC ---

        const showGameStats = async (gameId) => {
            statsModal.classList.remove('hidden');
            document.getElementById('modal-loading-message').classList.remove('hidden');
            document.getElementById('modal-stats-container').classList.add('hidden');

            try {
                const response = await fetch(`/api/nhl-game-stats?id=${gameId}`);
                const data = await response.json();

                if (response.status === 404) {
                    throw new Error(data.error || 'Stats are not yet available.');
                }
                if (!response.ok) {
                    throw new Error(data.error || 'Could not load game stats.');
                }

                renderStats(data);

            } catch (error) {
                 document.getElementById('modal-loading-message').innerText = error.message;
            }
        };

        const renderStats = ({ teamStats }) => {
            const statsContainer = document.getElementById('modal-stats-container');
            
            const statsHtml = `
                <h3 class="text-xl font-bold mb-4 text-center text-white">Team Stats</h3>
                <div class="grid grid-cols-3 gap-x-4 gap-y-2 text-center text-gray-300">
                    <div class="font-semibold">Stat</div>
                    <div class="font-semibold">Away</div>
                    <div class="font-semibold">Home</div>

                    ${createStatRow('Shots', teamStats.shotsOnGoal.away, teamStats.shotsOnGoal.home)}
                    ${createStatRow('Hits', teamStats.hits.away, teamStats.hits.home)}
                    ${createStatRow('Blocks', teamStats.blockedShots.away, teamStats.blockedShots.home)}
                    ${createStatRow('PIMs', teamStats.penaltyMinutes.away, teamStats.penaltyMinutes.home)}
                    ${createStatRow('Power Play', teamStats.powerPlays.away, teamStats.powerPlays.home)}
                </div>
            `;
            
            statsContainer.innerHTML = statsHtml;
            document.getElementById('modal-loading-message').classList.add('hidden');
            statsContainer.classList.remove('hidden');
        };

        const createStatRow = (label, awayStat, homeStat) => {
             const awayIsGreater = parseInt(awayStat) > parseInt(homeStat);
             const homeIsGreater = parseInt(homeStat) > parseInt(awayStat);
             return `
                <div class="bg-gray-700 p-2 rounded-l-md">${label}</div>
                <div class="bg-gray-700 p-2 ${awayIsGreater ? 'text-green-400 font-bold' : ''}">${awayStat}</div>
                <div class="bg-gray-700 p-2 rounded-r-md ${homeIsGreater ? 'text-green-400 font-bold' : ''}">${homeStat}</div>
            `;
        };

        // Event listener for hovering over scoreboard cards
        scoreboardContainer.addEventListener('mouseover', (e) => {
            const card = e.target.closest('.scoreboard-card');
            if (card) {
                const gameId = card.dataset.gameId;
                showGameStats(gameId);
            }
        });
        
        // Hide modal when clicking outside of the content
        statsModal.addEventListener('click', (e) => {
            if (e.target === statsModal) {
                statsModal.classList.add('hidden');
            }
        });
        
        // Initial data fetch and refresh intervals
        fetchScores();
        fetchNews();
        setInterval(fetchScores, 15000); // Refresh scores every 15 seconds
        setInterval(fetchNews, 300000); // Refresh news every 5 minutes

    </script>
</body>
</html>

