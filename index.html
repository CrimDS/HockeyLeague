<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fox & Hounds Hockey League</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000; /* Black background */
        }
        .card {
            background-color: #111111; /* Near-black card */
            border: 1px solid #333333; /* Dark gray border */
            transition: all 0.2s ease-in-out;
        }
        .card:hover:not(.no-hover) {
            border-color: #FFD700; /* Gold */
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(255, 215, 0, 0.15); /* Gold shadow */
        }
        .header-glow {
            border-bottom: 1px solid #333333;
        }
        .team-logo {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #333333;
        }
        .score {
            font-size: 2.25rem; /* 36px */
            font-weight: 700;
            color: #f0f6fc;
        }
        .vs-circle {
            background-color: #000000; /* Match body background */
            border: 1px solid #333333;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #8b949e;
        }
        .rank-number {
            font-weight: 600;
            color: #DC143C; /* Crimson */
        }
        /* Editor Styles */
        .modal-backdrop {
            background-color: rgba(0,0,0,0.7);
        }
        .admin-btn, .btn-primary, .btn-secondary, .btn-danger {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .admin-btn {
            background-color: transparent;
            border: 1px solid #FFD700;
            color: #FFD700;
        }
        .admin-btn:hover {
            background-color: rgba(255, 215, 0, 0.1);
        }
        .btn-primary {
            background-color: #DC143C;
            color: white;
            border: 1px solid #DC143C;
        }
        .btn-primary:hover {
            background-color: #b81030;
        }
        .btn-secondary {
            background-color: #333;
            color: white;
            border: 1px solid #333;
        }
        .btn-secondary:hover {
            background-color: #444;
        }
        .btn-danger {
            background-color: #b91c1c;
            color: white;
        }
        .btn-danger:hover {
            background-color: #991b1b;
        }
        .form-input {
            background-color: #222;
            border: 1px solid #444;
            color: white;
            border-radius: 6px;
            padding: 8px 12px;
            width: 100%;
        }
        .admin-controls {
            display: none;
        }
        body.admin-mode .admin-controls {
            display: flex;
        }
        /* Navigation */
        .nav-link {
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 500;
            color: #9ca3af;
            transition: all 0.2s;
        }
        .nav-link:hover {
            color: #fff;
            background-color: #333;
        }
        .nav-link.active {
            color: #fff;
            background-color: #DC143C;
        }
        /* Player Stats Table */
        .stats-table th {
            cursor: pointer;
            user-select: none;
        }
        .stats-table th:hover {
            color: #FFD700;
        }
        .stats-table .sort-asc::after {
            content: ' ▲';
            font-size: 0.8em;
        }
        .stats-table .sort-desc::after {
            content: ' ▼';
            font-size: 0.8em;
        }
        .player-headshot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            background-color: #333;
        }
    </style>
</head>
<body class="text-gray-300">

    <!-- All Modals -->
    <div id="admin-login-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="card no-hover p-8 rounded-lg w-full max-w-sm">
            <h2 class="text-2xl font-bold text-white mb-4">Admin Login</h2>
            <p id="login-error" class="text-red-500 text-sm mb-4 hidden">Invalid password.</p>
            <form id="login-form">
                <input id="password-input" type="password" class="form-input mb-4" placeholder="Enter password...">
                <div class="flex justify-end space-x-4">
                    <button type="button" onclick="toggleLoginModal(false)" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary">Login</button>
                </div>
            </form>
        </div>
    </div>
    <div id="edit-matchup-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="card no-hover p-8 rounded-lg w-full max-w-lg">
            <h2 id="matchup-modal-title" class="text-2xl font-bold text-white mb-6">Edit Matchup</h2>
            <form id="edit-matchup-form">
                <input type="hidden" id="edit-matchup-id">
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">Team 1</label>
                        <select id="edit-team1-id" class="form-input"></select>
                        <label class="block text-sm font-medium text-gray-400 mt-4 mb-1">Team 1 Score</label>
                        <input id="edit-team1-score" type="number" step="0.1" class="form-input" placeholder="Score">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">Team 2</label>
                        <select id="edit-team2-id" class="form-input"></select>
                        <label class="block text-sm font-medium text-gray-400 mt-4 mb-1">Team 2 Score</label>
                        <input id="edit-team2-score" type="number" step="0.1" class="form-input" placeholder="Score">
                    </div>
                </div>
                 <div class="flex justify-end space-x-4 mt-8">
                    <button type="button" onclick="toggleEditMatchupModal(false)" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    <div id="team-manager-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="card no-hover p-8 rounded-lg w-full max-w-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">Manage Teams</h2>
                <button onclick="openAddTeamModal()" class="admin-btn text-sm">+ Add Team</button>
            </div>
            <div id="team-list-container" class="max-h-96 overflow-y-auto pr-2"></div>
            <div class="flex justify-end mt-8">
                 <button type="button" onclick="toggleTeamManagerModal(false)" class="btn-secondary">Close</button>
            </div>
        </div>
    </div>
    <div id="edit-team-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="card no-hover p-8 rounded-lg w-full max-w-md">
            <h2 id="team-modal-title" class="text-2xl font-bold text-white mb-6">Edit Team</h2>
            <form id="edit-team-form">
                <input type="hidden" id="edit-team-id">
                <div class="space-y-4">
                    <div><label class="block text-sm font-medium text-gray-400 mb-1">Team Name</label><input id="edit-team-name" type="text" class="form-input" required></div>
                    <div><label class="block text-sm font-medium text-gray-400 mb-1">Logo URL</label><input id="edit-team-logo" type="text" class="form-input"></div>
                    <div class="grid grid-cols-3 gap-4">
                        <div><label class="block text-sm font-medium text-gray-400 mb-1">Wins</label><input id="edit-team-wins" type="number" class="form-input" value="0"></div>
                        <div><label class="block text-sm font-medium text-gray-400 mb-1">Losses</label><input id="edit-team-losses" type="number" class="form-input" value="0"></div>
                        <div><label class="block text-sm font-medium text-gray-400 mb-1">Ties</label><input id="edit-team-ties" type="number" class="form-input" value="0"></div>
                    </div>
                </div>
                <div class="flex justify-end space-x-4 mt-8">
                    <button type="button" onclick="toggleEditTeamModal(false)" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    <div id="confirmation-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="card no-hover p-8 rounded-lg w-full max-w-sm">
            <h2 class="text-xl font-bold text-white mb-4">Are you sure?</h2>
            <p id="confirmation-message" class="text-gray-300 mb-6">This action cannot be undone.</p>
            <div class="flex justify-end space-x-4">
                <button type="button" onclick="closeConfirmationModal()" class="btn-secondary">Cancel</button>
                <button type="button" id="confirm-action-btn" class="btn-danger">Delete</button>
            </div>
        </div>
    </div>

    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-black/70 backdrop-blur-sm sticky top-0 z-10 header-glow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center space-x-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM5.5 9.5a.5.5 0 01.5-.5h2a.5.5 0 01.5.5v2a.5.5 0 01-.5.5h-2a.5.5 0 01-.5-.5v-2zM12 5.5a.5.5 0 00-.5.5v2a.5.5 0 00.5.5h2a.5.5 0 00.5-.5v-2a.5.5 0 00-.5-.5h-2zM6 12a.5.5 0 00-.5.5v2a.5.5 0 00.5.5h2a.5.5 0 00.5-.5v-2a.5.5 0 00-.5-.5H6zM11.5 12a.5.5 0 01.5-.5h2a.5.5 0 01.5.5v2a.5.5 0 01-.5.5h-2a.5.5 0 01-.5-.5v-2z" clip-rule="evenodd" /></svg>
                        <h1 class="text-2xl font-bold text-white">Fox & Hounds Hockey League</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Navigation -->
                        <nav class="flex space-x-2">
                            <a href="#matchups" id="nav-matchups" onclick="showPage('matchups')" class="nav-link">Matchups</a>
                            <a href="#player-stats" id="nav-player-stats" onclick="showPage('player-stats')" class="nav-link">Player Stats</a>
                        </nav>
                         <button id="admin-login-btn" onclick="toggleLoginModal(true)" class="admin-btn">Admin Login</button>
                         <button id="admin-logout-btn" onclick="logout()" class="admin-btn hidden">Logout</button>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-10">
            <!-- Page: Matchups & Standings -->
            <div id="page-matchups">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 space-y-6">
                        <div class="flex justify-between items-center px-2">
                            <h2 class="text-2xl font-semibold text-white">Weekly Matchups</h2>
                            <div class="admin-controls"><button onclick="addMatchup()" class="admin-btn text-sm">+ Add Matchup</button></div>
                        </div>
                        <div id="matchups-container" class="space-y-6"></div>
                    </div>
                    <div class="space-y-6">
                         <div class="flex justify-between items-center px-2">
                            <h2 class="text-2xl font-semibold text-white">League Standings</h2>
                            <div class="admin-controls"><button onclick="toggleTeamManagerModal(true)" class="admin-btn text-sm">Manage Teams</button></div>
                        </div>
                        <div class="card rounded-lg p-4"><ul id="standings-container" class="divide-y divide-gray-800"></ul></div>
                    </div>
                </div>
            </div>

            <!-- Page: Player Stats -->
            <div id="page-player-stats" class="hidden">
                <h2 class="text-2xl font-semibold text-white mb-6">NHL Player Stats</h2>
                <div class="card p-4 sm:p-6 rounded-lg">
                    <div class="mb-4">
                        <input type="text" id="player-search-input" class="form-input max-w-xs" placeholder="Search for a player...">
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm stats-table">
                            <thead class="text-xs text-gray-400 uppercase bg-gray-900/50">
                                <tr>
                                    <th scope="col" class="px-4 py-3" onclick="sortPlayerStats('name')">Player</th>
                                    <th scope="col" class="px-4 py-3" onclick="sortPlayerStats('team')">Team</th>
                                    <th scope="col" class="px-4 py-3 text-center" onclick="sortPlayerStats('gamesPlayed')">GP</th>
                                    <th scope="col" class="px-4 py-3 text-center" onclick="sortPlayerStats('goals')">G</th>
                                    <th scope="col" class="px-4 py-3 text-center" onclick="sortPlayerStats('assists')">A</th>
                                    <th scope="col" class="px-4 py-3 text-center" onclick="sortPlayerStats('points')">Pts</th>
                                    <th scope="col" class="px-4 py-3 text-center" onclick="sortPlayerStats('plusMinus')">+/-</th>
                                    <th scope="col" class="px-4 py-3 text-center" onclick="sortPlayerStats('penaltyMinutes')">PIM</th>
                                    <th scope="col" class="px-4 py-3 text-center" onclick="sortPlayerStats('shotsOnGoal')">SOG</th>
                                    <th scope="col" class="px-4 py-3 text-center" onclick="sortPlayerStats('hits')">Hits</th>
                                    <th scope="col" class="px-4 py-3 text-center" onclick="sortPlayerStats('blockedShots')">BS</th>
                                </tr>
                            </thead>
                            <tbody id="player-stats-body" class="divide-y divide-gray-800">
                                <!-- Player rows will be dynamically inserted here -->
                            </tbody>
                        </table>
                        <div id="player-stats-loader" class="text-center py-12">
                            <p>Loading Player Stats...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

<script>
    // --- GLOBAL STATE ---
    let leagueData = {};
    let isAdmin = false;
    let allPlayerStats = [];
    let currentSort = { column: 'points', direction: 'desc' };

    const defaultData = {
        teams: [
            { id: 1, name: "Puck Hogs", wins: 8, losses: 2, ties: 0, logo: "https://placehold.co/100x100/FFD700/000000?text=P" },
            { id: 2, name: "The Great Ones", wins: 6, losses: 4, ties: 0, logo: "https://placehold.co/100x100/DC143C/FFFFFF?text=G" },
            { id: 3, name: "Ice Vipers", wins: 5, losses: 5, ties: 0, logo: "https://placehold.co/100x100/1E40AF/FFFFFF?text=V" },
            { id: 4, name: "Blade Runners", wins: 3, losses: 7, ties: 0, logo: "https://placehold.co/100x100/16A34A/FFFFFF?text=B" }
        ],
        matchups: [
            { id: 1, team1_id: 1, team2_id: 2, team1_score: 125.7, team2_score: 98.2 },
            { id: 2, team1_id: 3, team2_id: 4, team1_score: 105.5, team2_score: 110.1 }
        ]
    };

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        checkAdminState();
        setupEventListeners();
        
        // Handle initial page load based on URL hash
        const initialPage = window.location.hash.substring(1) || 'matchups';
        showPage(initialPage);
    });

    function setupEventListeners() {
        document.getElementById('login-form').addEventListener('submit', handleLogin);
        document.getElementById('edit-matchup-form').addEventListener('submit', handleSaveMatchup);
        document.getElementById('edit-team-form').addEventListener('submit', handleSaveTeam);
        document.getElementById('player-search-input').addEventListener('input', (e) => renderPlayerStats(e.target.value));
    }

    // --- DATA MANAGEMENT ---
    function loadData() {
        const savedData = localStorage.getItem('foxAndHoundsData');
        leagueData = savedData ? JSON.parse(savedData) : JSON.parse(JSON.stringify(defaultData));
        if (!savedData) saveData();
    }

    function saveData() {
        localStorage.setItem('foxAndHoundsData', JSON.stringify(leagueData));
    }

    function getTeamById(id) {
        return leagueData.teams.find(t => t.id === id);
    }
    
    // --- NAVIGATION ---
    function showPage(pageName) {
        document.getElementById('page-matchups').classList.add('hidden');
        document.getElementById('page-player-stats').classList.add('hidden');
        document.getElementById('nav-matchups').classList.remove('active');
        document.getElementById('nav-player-stats').classList.remove('active');

        const pageElement = document.getElementById(`page-${pageName}`);
        const navElement = document.getElementById(`nav-${pageName}`);

        if (pageElement) {
            pageElement.classList.remove('hidden');
            if (navElement) navElement.classList.add('active');
            window.location.hash = pageName;
        }

        if (pageName === 'matchups') {
            renderAllLeagueData();
        } else if (pageName === 'player-stats') {
            loadPlayerStats();
        }
    }

    // --- PAGE-SPECIFIC RENDER & LOGIC ---

    // Matchups Page
    function renderAllLeagueData() {
        renderMatchups();
        renderStandings();
        toggleAdminUI();
    }

    function renderMatchups() {
        const container = document.getElementById('matchups-container');
        container.innerHTML = '';
        if (leagueData.matchups.length === 0) {
            container.innerHTML = `<div class="card rounded-lg p-6 text-center text-gray-400">No matchups to display.</div>`;
            return;
        }
        leagueData.matchups.forEach(matchup => {
            const team1 = getTeamById(matchup.team1_id);
            const team2 = getTeamById(matchup.team2_id);
            if (!team1 || !team2) return;
            container.innerHTML += `
                <div class="card rounded-lg p-6 relative">
                    <div class="admin-controls absolute top-2 right-2 space-x-2">
                        <button onclick="openEditMatchupModal(${matchup.id})" class="text-xs text-yellow-400 hover:text-yellow-300">Edit</button>
                        <button onclick="confirmDeleteMatchup(${matchup.id})" class="text-xs text-red-500 hover:text-red-400">Delete</button>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="flex flex-col items-center text-center w-1/3">
                            <img class="team-logo" src="${team1.logo}" alt="${team1.name} logo"><p class="font-bold text-lg mt-2">${team1.name}</p><p class="text-sm text-gray-400">${team1.wins}-${team1.losses}-${team1.ties}</p>
                        </div>
                        <div class="flex items-center justify-center flex-grow">
                            <p class="score">${matchup.team1_score || 0}</p><div class="vs-circle mx-6">VS</div><p class="score">${matchup.team2_score || 0}</p>
                        </div>
                        <div class="flex flex-col items-center text-center w-1/3">
                            <img class="team-logo" src="${team2.logo}" alt="${team2.name} logo"><p class="font-bold text-lg mt-2">${team2.name}</p><p class="text-sm text-gray-400">${team2.wins}-${team2.losses}-${team2.ties}</p>
                        </div>
                    </div>
                </div>`;
        });
    }

    function renderStandings() {
        const container = document.getElementById('standings-container');
        container.innerHTML = '';
        const sortedTeams = [...leagueData.teams].sort((a, b) => b.wins - a.wins || a.losses - b.losses);
        sortedTeams.forEach((team, index) => {
            container.innerHTML += `
                <li class="py-3 flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="rank-number w-6 text-center">${index + 1}</span>
                        <img class="team-logo w-8 h-8 ml-3" src="${team.logo}" alt="${team.name} logo">
                        <p class="ml-3 font-medium text-white">${team.name}</p>
                    </div>
                    <p class="text-gray-400 font-mono text-sm">${team.wins}-${team.losses}-${team.ties}</p>
                </li>`;
        });
    }

    // Player Stats Page
    async function loadPlayerStats() {
        if (allPlayerStats.length > 0) {
            renderPlayerStats();
            return;
        }
        document.getElementById('player-stats-loader').style.display = 'block';
        try {
            const response = await fetch('/api/nhl-player-stats');
            if (!response.ok) throw new Error('Failed to fetch stats');
            allPlayerStats = await response.json();
            sortPlayerStats(currentSort.column, true); // Initial sort
        } catch (error) {
            console.error(error);
            document.getElementById('player-stats-body').innerHTML = `<tr><td colspan="11" class="text-center py-8 text-red-500">Could not load player stats.</td></tr>`;
        } finally {
            document.getElementById('player-stats-loader').style.display = 'none';
        }
    }

    function sortPlayerStats(column, forceSort = false) {
        if (!forceSort && currentSort.column === column) {
            currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
        } else {
            currentSort.column = column;
            currentSort.direction = 'desc';
        }

        allPlayerStats.sort((a, b) => {
            let valA = a[column];
            let valB = b[column];
            if (typeof valA === 'string') {
                valA = valA.toLowerCase();
                valB = valB.toLowerCase();
            }
            if (valA < valB) return currentSort.direction === 'asc' ? -1 : 1;
            if (valA > valB) return currentSort.direction === 'asc' ? 1 : -1;
            return 0;
        });

        renderPlayerStats(document.getElementById('player-search-input').value);
        updateSortHeaders();
    }
    
    function updateSortHeaders() {
        document.querySelectorAll('.stats-table th').forEach(th => {
            th.classList.remove('sort-asc', 'sort-desc');
        });
        const activeHeader = document.querySelector(`.stats-table th[onclick="sortPlayerStats('${currentSort.column}')"]`);
        if (activeHeader) {
            activeHeader.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
    }
    
    function renderPlayerStats(filter = '') {
        const container = document.getElementById('player-stats-body');
        const filterLower = filter.toLowerCase();
        
        const filteredStats = allPlayerStats.filter(p => p.name.toLowerCase().includes(filterLower));
        
        if (filteredStats.length === 0) {
            container.innerHTML = `<tr><td colspan="11" class="text-center py-8 text-gray-400">No players found.</td></tr>`;
            return;
        }

        container.innerHTML = filteredStats.map(p => `
            <tr class="hover:bg-gray-800/50">
                <td class="px-4 py-2">
                    <div class="flex items-center">
                        <img src="${p.headshot}" alt="${p.name}" class="player-headshot mr-3">
                        <div>
                            <div class="font-medium text-white">${p.name}</div>
                            <div class="text-gray-400 text-xs">${p.position}</div>
                        </div>
                    </div>
                </td>
                <td class="px-4 py-2 font-mono">${p.team}</td>
                <td class="px-4 py-2 text-center">${p.gamesPlayed}</td>
                <td class="px-4 py-2 text-center">${p.goals}</td>
                <td class="px-4 py-2 text-center">${p.assists}</td>
                <td class="px-4 py-2 text-center font-bold text-white">${p.points}</td>
                <td class="px-4 py-2 text-center">${p.plusMinus}</td>
                <td class="px-4 py-2 text-center">${p.penaltyMinutes}</td>
                <td class="px-4 py-2 text-center">${p.shotsOnGoal}</td>
                <td class="px-4 py-2 text-center">${p.hits}</td>
                <td class="px-4 py-2 text-center">${p.blockedShots}</td>
            </tr>
        `).join('');
    }

    // --- ADMIN & EDITOR LOGIC ---
    function checkAdminState() {
        isAdmin = sessionStorage.getItem('isAdmin') === 'true';
    }

    function toggleAdminUI() {
        document.body.classList.toggle('admin-mode', isAdmin);
        document.getElementById('admin-login-btn').classList.toggle('hidden', isAdmin);
        document.getElementById('admin-logout-btn').classList.toggle('hidden', !isAdmin);
    }
    
    // Generic Modal Toggles
    const toggleModal = (modalId, show) => document.getElementById(modalId).classList.toggle('hidden', !show).classList.toggle('flex', show);
    const toggleLoginModal = (show) => toggleModal('admin-login-modal', show);
    const toggleEditMatchupModal = (show) => toggleModal('edit-matchup-modal', show);
    const toggleTeamManagerModal = (show) => { if (show) renderTeamList(); toggleModal('team-manager-modal', show); };
    const toggleEditTeamModal = (show) => toggleModal('edit-team-modal', show);

    function handleLogin(e) {
        e.preventDefault();
        if (document.getElementById('password-input').value === 'foxandhounds') {
            isAdmin = true;
            sessionStorage.setItem('isAdmin', 'true');
            toggleLoginModal(false);
            renderAllLeagueData();
        } else {
            document.getElementById('login-error').classList.remove('hidden');
        }
    }

    function logout() {
        isAdmin = false;
        sessionStorage.removeItem('isAdmin');
        renderAllLeagueData();
    }
    
    // Matchup Editor
    function populateTeamSelect(selectId, selectedId) {
        const select = document.getElementById(selectId);
        select.innerHTML = leagueData.teams.map(team => `<option value="${team.id}" ${team.id === selectedId ? 'selected' : ''}>${team.name}</option>`).join('');
    }

    function openEditMatchupModal(matchupId) {
        const matchup = leagueData.matchups.find(m => m.id === matchupId);
        if (!matchup) return;
        document.getElementById('matchup-modal-title').textContent = "Edit Matchup";
        document.getElementById('edit-matchup-id').value = matchup.id;
        populateTeamSelect('edit-team1-id', matchup.team1_id);
        document.getElementById('edit-team1-score').value = matchup.team1_score;
        populateTeamSelect('edit-team2-id', matchup.team2_id);
        document.getElementById('edit-team2-score').value = matchup.team2_score;
        toggleEditMatchupModal(true);
    }
    
    function addMatchup() {
        document.getElementById('edit-matchup-form').reset();
        document.getElementById('matchup-modal-title').textContent = "Add Matchup";
        document.getElementById('edit-matchup-id').value = '';
        populateTeamSelect('edit-team1-id', leagueData.teams[0]?.id);
        populateTeamSelect('edit-team2-id', leagueData.teams[1]?.id);
        toggleEditMatchupModal(true);
    }

    function handleSaveMatchup(e) {
        e.preventDefault();
        const id = parseInt(document.getElementById('edit-matchup-id').value);
        const team1_id = parseInt(document.getElementById('edit-team1-id').value);
        const team1_score = parseFloat(document.getElementById('edit-team1-score').value) || 0;
        const team2_id = parseInt(document.getElementById('edit-team2-id').value);
        const team2_score = parseFloat(document.getElementById('edit-team2-score').value) || 0;
        if (team1_id === team2_id) { alert("A team cannot play against itself."); return; }
        if (id) {
            const index = leagueData.matchups.findIndex(m => m.id === id);
            if (index > -1) leagueData.matchups[index] = { id, team1_id, team2_id, team1_score, team2_score };
        } else {
             const newId = leagueData.matchups.length > 0 ? Math.max(...leagueData.matchups.map(m => m.id)) + 1 : 1;
             leagueData.matchups.push({ id: newId, team1_id, team2_id, team1_score, team2_score });
        }
        saveData();
        renderAllLeagueData();
        toggleEditMatchupModal(false);
    }

    // Team Editor
    function renderTeamList() {
        const container = document.getElementById('team-list-container');
        if (leagueData.teams.length === 0) { container.innerHTML = `<p class="text-gray-400 text-center">No teams.</p>`; return; }
        container.innerHTML = leagueData.teams.map(team => `
            <div class="flex items-center justify-between p-2 rounded-md hover:bg-gray-800">
                <div class="flex items-center"><img class="team-logo w-8 h-8" src="${team.logo}" alt="${team.name} logo"><p class="ml-4 font-medium text-white">${team.name}</p></div>
                <div class="space-x-4">
                    <button onclick="openEditTeamModal(${team.id})" class="text-xs text-yellow-400 hover:text-yellow-300">Edit</button>
                    <button onclick="confirmDeleteTeam(${team.id})" class="text-xs text-red-500 hover:text-red-400">Delete</button>
                </div>
            </div>`).join('');
    }

    function openEditTeamModal(teamId) {
        const team = getTeamById(teamId);
        if (!team) return;
        document.getElementById('team-modal-title').textContent = "Edit Team";
        Object.entries({id:team.id, name:team.name, logo:team.logo, wins:team.wins, losses:team.losses, ties:team.ties}).forEach(([key, value]) => document.getElementById(`edit-team-${key}`).value = value);
        toggleEditTeamModal(true);
    }

    function openAddTeamModal() {
        document.getElementById('edit-team-form').reset();
        document.getElementById('team-modal-title').textContent = "Add New Team";
        document.getElementById('edit-team-id').value = '';
        toggleEditTeamModal(true);
    }

    function handleSaveTeam(e) {
        e.preventDefault();
        const id = parseInt(document.getElementById('edit-team-id').value);
        const name = document.getElementById('edit-team-name').value;
        if (!name) { alert("Team name cannot be empty."); return; }
        const teamData = {
            name,
            logo: document.getElementById('edit-team-logo').value || `https://placehold.co/100x100/333/FFFFFF?text=${name.charAt(0)}`,
            wins: parseInt(document.getElementById('edit-team-wins').value) || 0,
            losses: parseInt(document.getElementById('edit-team-losses').value) || 0,
            ties: parseInt(document.getElementById('edit-team-ties').value) || 0
        };
        if (id) {
            const index = leagueData.teams.findIndex(t => t.id === id);
            if (index > -1) leagueData.teams[index] = { id, ...teamData };
        } else {
            const newId = leagueData.teams.length > 0 ? Math.max(...leagueData.teams.map(t => t.id)) + 1 : 1;
            leagueData.teams.push({ id: newId, ...teamData });
        }
        saveData();
        renderAllLeagueData();
        renderTeamList();
        toggleEditTeamModal(false);
    }
    
    // Deletion Logic
    let onConfirmAction = null;
    const confirmBtn = document.getElementById('confirm-action-btn');

    function showConfirmationModal(message, callback) {
        document.getElementById('confirmation-message').textContent = message;
        onConfirmAction = callback;
        confirmBtn.onclick = () => { if (onConfirmAction) onConfirmAction(); closeConfirmationModal(); };
        toggleModal('confirmation-modal', true);
    }

    function closeConfirmationModal() {
        onConfirmAction = null;
        toggleModal('confirmation-modal', false);
    }

    function confirmDeleteMatchup(matchupId) {
        const matchup = leagueData.matchups.find(m => m.id === matchupId);
        const team1 = getTeamById(matchup.team1_id);
        const team2 = getTeamById(matchup.team2_id);
        const message = `Delete the matchup between ${team1.name} and ${team2.name}?`;
        showConfirmationModal(message, () => {
            leagueData.matchups = leagueData.matchups.filter(m => m.id !== matchupId);
            saveData();
            renderAllLeagueData();
        });
    }

    function confirmDeleteTeam(teamId) {
        const team = getTeamById(teamId);
        const message = `Delete ${team.name}? This also removes their matchups.`;
        showConfirmationModal(message, () => {
            leagueData.teams = leagueData.teams.filter(t => t.id !== teamId);
            leagueData.matchups = leagueData.matchups.filter(m => m.team1_id !== teamId && m.team2_id !== teamId);
            saveData();
            renderAllLeagueData();
            renderTeamList();
        });
    }
</script>
</body>
</html>

