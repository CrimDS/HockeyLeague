<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Fox & Hounds</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #000000; }
        .card { background-color: #111111; border: 1px solid #333333; }
        .header-glow { border-bottom: 1px solid #333; }
        .admin-btn, .btn-primary, .btn-secondary, .btn-danger { padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .admin-btn { background-color: transparent; border: 1px solid #FFD700; color: #FFD700; }
        .admin-btn:hover:not(:disabled) { background-color: rgba(255, 215, 0, 0.1); }
        .btn-primary { background-color: #DC143C; color: white; border: 1px solid #DC143C; text-align: center; display: block; }
        .btn-primary:hover { background-color: #b81030; }
        .btn-secondary { background-color: #333; color: white; border: 1px solid #333; }
        .btn-secondary:hover:not(:disabled) { background-color: #444; }
        .btn-danger { background-color: #b91c1c; color: white; }
        .form-input { background-color: #222; border: 1px solid #444; color: white; border-radius: 6px; padding: 8px 12px; width: 100%; }
        .modal-backdrop { background-color: rgba(0,0,0,0.7); }
    </style>
</head>
<body class="text-gray-300">
    <header class="bg-black/70 backdrop-blur-sm sticky top-0 z-40 header-glow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <a href="index.html" class="flex items-center space-x-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM5.5 9.5a.5.5 0 01.5-.5h2a.5.5 0 01.5.5v2a.5.5 0 01-.5.5h-2a.5.5 0 01-.5-.5v-2zM12 5.5a.5.5 0 00-.5.5v2a.5.5 0 00.5.5h2a.5.5 0 00.5-.5v-2a.5.5 0 00-.5-.5h-2zM6 12a.5.5 0 00-.5.5v2a.5.5 0 00.5.5h2a.5.5 0 00.5-.5v-2a.5.5 0 00-.5-.5H6zM11.5 12a.5.5 0 01.5-.5h2a.5.5 0 01.5.5v2a.5.5 0 01-.5.5h-2a.5.5 0 01-.5-.5v-2z" clip-rule="evenodd" /></svg><h1 class="text-xl font-bold text-white">Fox & Hounds - Admin</h1></a>
                <div class="flex items-center space-x-4">
                     <button id="admin-logout-btn" onclick="logout()" class="admin-btn">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <main id="admin-panel" class="max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-10 hidden">
        <div id="yahoo-success-message" class="hidden bg-green-900 border border-green-700 text-green-200 px-4 py-3 rounded-lg relative mb-6" role="alert">
            <strong class="font-bold">Success!</strong>
            <span class="block sm:inline">Your Yahoo account is connected. You can now fetch live league data.</span>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="card p-6">
                <h2 class="text-xl font-bold text-white mb-4">Manage League Data (Manual)</h2>
                <div class="space-y-4">
                    <p class="text-sm text-gray-400">Manually edit teams, matchups, and other site data.</p>
                    <button onclick="toggleTeamManagerModal(true)" class="w-full btn-secondary">Manage Teams</button>
                    <button onclick="addMatchup()" class="w-full btn-secondary">Manage Matchups</button>
                </div>
            </div>
             <div class="card p-6">
                <h2 class="text-xl font-bold text-white mb-4">Yahoo Fantasy API</h2>
                <div class="space-y-4">
                    <p class="text-sm text-gray-400">Connect your Yahoo account to automatically sync league data.</p>
                    <button id="yahoo-connect-btn" class="w-full btn-primary">Connect Yahoo Account</button>
                </div>
            </div>
            <div class="card p-6 lg:col-span-3">
                <h2 class="text-xl font-bold text-white mb-4">Yahoo League Data</h2>
                <button id="fetch-leagues-btn" class="admin-btn mb-4">Fetch My Leagues</button>
                <pre id="leagues-output" class="bg-black p-4 rounded-md text-xs overflow-x-auto h-96"></pre>
            </div>
        </div>
    </main>
    
    <div id="admin-login-modal" class="fixed inset-0 z-50 items-center justify-center flex modal-backdrop"><div class="card no-hover p-8 rounded-lg w-full max-w-sm"><h2 class="text-2xl font-bold text-white mb-4">Admin Login</h2><p id="login-error" class="text-red-500 text-sm mb-4 hidden">Invalid password.</p><form id="login-form"><input id="password-input" type="password" class="form-input mb-4" placeholder="Enter password..."><div class="flex justify-end space-x-4"><button type="button" onclick="window.location.href='index.html'" class="btn-secondary">Cancel</button><button type="submit" class="btn-primary">Login</button></div></form></div></div>
    <!-- Other modals will be here -->
    <div id="edit-matchup-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><!--...--></div>
    <div id="team-manager-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><!--...--></div>
    <div id="edit-team-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><!--...--></div>
    <div id="confirmation-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><!--...--></div>

    <script>
        let leagueData={},pageContent={},isAdmin=!1;
        
        document.addEventListener('DOMContentLoaded', () => {
            checkAdminState();
            if (isAdmin) {
                document.getElementById('admin-login-modal').style.display = 'none';
                document.getElementById('admin-panel').classList.remove('hidden');
                loadData();
                
                // Check for the success flag from the Yahoo redirect
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('yahoo_connected') === 'true') {
                    document.getElementById('yahoo-success-message').classList.remove('hidden');
                }

                // **FIX**: Changed from an `<a>` tag to a `<button>` with a JS event listener
                document.getElementById('yahoo-connect-btn').addEventListener('click', () => {
                    // This dynamically gets the current URL origin (e.g., https://your-site.vercel.app)
                    const origin = window.location.origin;
                    // And sends it to the backend, which guarantees the redirect_uri will match.
                    window.location.href = `/api/yahoo-login?origin=${encodeURIComponent(origin)}`;
                });

                document.getElementById('fetch-leagues-btn').addEventListener('click', async () => {
                    const output = document.getElementById('leagues-output');
                    output.textContent = 'Fetching leagues...';
                    try {
                        const response = await fetch('/api/get-yahoo-leagues');
                        const data = await response.json();
                        if (response.ok) {
                             output.textContent = JSON.stringify(data, null, 2);
                        } else {
                            output.textContent = `Error: ${data.error || 'Failed to fetch'}`;
                        }
                    } catch (error) {
                        output.textContent = `An error occurred: ${error.message}`;
                    }
                });
            }
             document.getElementById('login-form').addEventListener('submit', handleLogin);
        });
        function checkAdminState(){if("true"===sessionStorage.getItem("isAdmin"))isAdmin=!0}
        function handleLogin(e){e.preventDefault();if("foxandhounds"===document.getElementById("password-input").value){isAdmin=!0,sessionStorage.setItem("isAdmin","true"),window.location.reload()}}
        function logout(){document.cookie="yahoo_refresh_token=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/;";sessionStorage.removeItem("isAdmin"),window.location.href="index.html"}
        function loadData(){const e=localStorage.getItem("foxAndHoundsData");leagueData=e?JSON.parse(e):{teams:[], matchups:[]}}
        function saveData(){localStorage.setItem("foxAndHoundsData",JSON.stringify(leagueData))}
        
        // --- ALL MANUAL DATA/MODAL FUNCTIONS GO HERE ---
    </script>
</body>
</html>

